"use strict";var DeclarationBundlerPlugin=function(){function e(e){this.out=e.out||"./dist/",this.excludedReferences=e.excludedReferences||[],this.importModels=e.importModels||[]}return e.prototype.apply=function(e){var o=this;e.hooks.emit.tapAsync("DeclarationBundlerWebpack4Plugin",function(e,t){var n={};for(var r in e.assets)-1!==r.indexOf(".d.ts")&&(n[r]=e.assets[r],delete e.assets[r]);var i=o.generateCombinedDeclaration(n);e.assets[o.out]={source:function(){return i},size:function(){return i.length}},t()})},e.prototype.generateCombinedDeclaration=function(e){var r=/import ([\{A-Za-z0-9 ,\}]+)/;this.importModels&&0<this.importModels.length&&(r=new RegExp("import ([{A-Za-z0-9 ,}]+) '("+this.importModels.join("|")+")'"));var i=[],t="";for(var n in e){for(var o=e[n].source().split("\n"),s=o.length,a=function(){var t=o[s],e=""===t;e=(e=e||-1!==t.indexOf("export ="))||/import ([a-z0-9A-Z_-]+) = require\(/.test(t);var n=r.test(t);e=e||r.test(t),n&&i.push(t),!e&&u.excludedReferences&&-1!==t.indexOf("<reference")&&(e=u.excludedReferences.some(function(e){return-1!==t.indexOf(e)})),e?o.splice(s,1):(-1!==t.indexOf("declare ")&&(o[s]=t.replace("declare ","")),o[s]="\t"+o[s])},u=this;s--;)a();t+=o.join("\n")+"\n\n"}return i.join("\n")+"\n\n"+t},e}();module.exports=DeclarationBundlerPlugin;