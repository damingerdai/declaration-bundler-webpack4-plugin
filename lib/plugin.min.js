"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DeclarationBundlerPlugin=function(){function e(e){if(!e.moduleName)throw new Error("please set a moduleName if you use mode:internal. new DacoreWebpackPlugin({mode:'internal',moduleName:...})");this.out=e.out||"./dist/",this.excludedReferences=e.excludedReferences||[],this.moduleName=e.moduleName}return e.prototype.apply=function(e){var a=this;e.hooks.emit.tapAsync("DeclarationBundlerWebpack4Plugin",function(e,n){var t={};for(var r in e.assets)-1!==r.indexOf(".d.ts")&&(t[r]=e.assets[r],delete e.assets[r]);var o=a.generateCombinedDeclaration(t);e.assets[a.out]={source:function(){return o},size:function(){return o.length}},n()})},e.prototype.generateCombinedDeclaration=function(e){var n="";for(var t in e){for(var r=e[t]._value.split("\n"),o=r.length,a=function(){var n=r[o],e=""===n;!(e=(e=(e=e||-1!==n.indexOf("export ="))||/import ([a-z0-9A-Z_-]+) = require\(/.test(n))||/import ([\{A-Za-z0-9 ,\}]+)/.test(n))&&i.excludedReferences&&-1!==n.indexOf("<reference")&&(e=i.excludedReferences.some(function(e){return-1!==n.indexOf(e)})),e?n.splice(o,1):(-1!==n.indexOf("declare ")&&(r[o]=n.replace("declare ","")),r[o]="\t"+r[o])},i=this;o--;)a();n+=r.join("\n")+"\n\n"}return"declare module "+this.moduleName+"\n{\n"+n+"}"},e}();exports.DeclarationBundlerPlugin=DeclarationBundlerPlugin;