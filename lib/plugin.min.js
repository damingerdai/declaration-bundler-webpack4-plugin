"use strict";var DeclarationBundlerPlugin=function(){function e(e){if(!e.moduleName)throw new Error("please set a moduleName if you use mode:internal. new DacoreWebpackPlugin({mode:'internal',moduleName:...})");this.out=e.out||"./dist/",this.excludedReferences=e.excludedReferences||[],this.moduleName=e.moduleName}return e.prototype.apply=function(e){var i=this;e.hooks.emit.tapAsync("DeclarationBundlerWebpack4Plugin",function(e,n){var r={};for(var t in e.assets)-1!==t.indexOf(".d.ts")&&(r[t]=e.assets[t],delete e.assets[t]);var o=i.generateCombinedDeclaration(r);e.assets[i.out]={source:function(){return o},size:function(){return o.length}},n()})},e.prototype.generateCombinedDeclaration=function(e){var n="";for(var r in e){for(var t=e[r].source().split("\n"),o=t.length,i=function(){var n=t[o],e=""===n;!(e=(e=e||-1!==n.indexOf("export ="))||/import ([a-z0-9A-Z_-]+) = require\(/.test(n))&&a.excludedReferences&&-1!==n.indexOf("<reference")&&(e=a.excludedReferences.some(function(e){return-1!==n.indexOf(e)})),e?t.splice(o,1):(-1!==n.indexOf("declare ")&&(t[o]=n.replace("declare ","")),t[o]="\t"+t[o])},a=this;o--;)i();n+=t.join("\n")+"\n\n"}return"declare module "+this.moduleName+"\n{\n"+n+"}"},e}();module.exports=DeclarationBundlerPlugin;